<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Variance Analysis Tool</title>
  <link rel="stylesheet" href="/frontend/styles.css?v=3" />
</head>
<body>
  <header>
    <div class="header-main">
      <img src="/frontend/assets/logo.png" alt="Logo" class="logo" />
      <h1 data-i18n="title">AI Variance Analysis Tool</h1>
      <div class="lang-toggle" role="tablist" aria-label="Language">
        <button id="lang-en" class="btn small active" role="tab" aria-selected="true">EN</button>
        <button id="lang-vi" class="btn small" role="tab" aria-selected="false">VI</button>
      </div>
    </div>
    <p class="subtitle" data-i18n="subtitle">Upload Excel â†’ AI Analyzes â†’ Download Results</p>
  </header>

  <main>
    <!-- LEFT: upload + AI info -->
    <section class="card" aria-labelledby="uploadRunHdr">
      <h2 id="uploadRunHdr" data-i18n="uploadRun">Upload & Process</h2>

      <div class="field">
        <label for="excel" data-i18n="excelLabel">Excel file(s)</label>
        <input id="excel" type="file" accept=".xlsx" multiple title=".xlsx" aria-describedby="excelHelp" />
        <div id="excelHelp" class="help" data-i18n="excelHelp">Select one or more .xlsx files for AI analysis</div>
      </div>

      <div class="ai-info-section">
        <h3 class="section-title" data-i18n="aiInfoTitle">ğŸ¤– AI-Powered Analysis</h3>
        <div class="ai-features">
          <div class="feature-item">
            <span class="icon">ğŸ§ </span>
            <div>
              <strong data-i18n="autoMateriality">Auto Materiality Detection</strong>
              <p data-i18n="autoMaterialityDesc">AI determines significance thresholds based on company size and data patterns</p>
            </div>
          </div>
          <div class="feature-item">
            <span class="icon">ğŸ”</span>
            <div>
              <strong data-i18n="smartFocus">Smart Focus Areas</strong>
              <p data-i18n="smartFocusDesc">Prioritizes Revenue, Utilities, and Interest Rate analysis automatically</p>
            </div>
          </div>
          <div class="feature-item">
            <span class="icon">ğŸ“</span>
            <div>
              <strong data-i18n="detailedExplanations">Detailed Explanations</strong>
              <p data-i18n="detailedExplanationsDesc">Every anomaly includes reasoning and business context</p>
            </div>
          </div>
        </div>
      </div>

      <div class="processing-status" id="processingStatus" style="display: none;">
        <h3 class="section-title">âš™ï¸ Processing Status</h3>
        <div class="status-steps" id="statusSteps">
          <!-- Dynamic status steps will be added here -->
        </div>
      </div>

      <div class="sep"></div>

      <div class="row">
        <button id="runBtn" class="btn primary" data-i18n="processBtn">ğŸš€ Analyze with AI</button>
        <span id="liveStatus" class="pill idle" data-i18n="idle">Ready</span>
      </div>

      <div class="field" style="margin-top:12px;">
        <label for="response" data-i18n="response">Analysis Progress</label>
        <div id="response" class="status" aria-live="polite"></div>
      </div>
    </section>

    <!-- RIGHT: explanations and info -->
    <section class="card">
      <h2 data-i18n="howItWorks">How AI Analysis Works</h2>

      <div class="info-section">
        <h3 data-i18n="step1Title">ğŸ“Š Step 1: Data Analysis</h3>
        <p data-i18n="step1Desc">AI examines your financial data to understand company size, account patterns, and business context</p>
      </div>

      <div class="info-section">
        <h3 data-i18n="step2Title">ğŸ¯ Step 2: Smart Thresholds</h3>
        <p data-i18n="step2Desc">Automatically determines materiality thresholds and focuses on critical areas: Revenue, Utilities, Interest Rates</p>
      </div>

      <div class="info-section">
        <h3 data-i18n="step3Title">ğŸ” Step 3: Anomaly Detection</h3>
        <p data-i18n="step3Desc">Identifies unusual patterns, variance issues, and accounting inconsistencies with detailed explanations</p>
      </div>

      <div class="info-section">
        <h3 data-i18n="step4Title">ğŸ“‹ Step 4: Detailed Report</h3>
        <p data-i18n="step4Desc">Generates Excel report with specific findings, business reasoning, and recommended actions</p>
      </div>

      <div class="download-section" id="downloadSection" style="display: none;">
        <h3 data-i18n="downloadTitle">ğŸ“¥ Download Results</h3>
        <button id="downloadBtn" class="btn" data-i18n="downloadBtn">Download Analysis</button>
      </div>
    </section>
  </main>

  <script>
    const translations = {
      "en": {
        title: "AI Variance Analysis Tool",
        subtitle: "Upload Excel â†’ AI Analyzes â†’ Download Results",
        uploadRun: "Upload & Process",
        excelLabel: "Excel file(s)",
        excelHelp: "Select one or more .xlsx files for AI analysis",
        aiInfoTitle: "ğŸ¤– AI-Powered Analysis",
        autoMateriality: "Auto Materiality Detection",
        autoMaterialityDesc: "AI determines significance thresholds based on company size and data patterns",
        smartFocus: "Smart Focus Areas",
        smartFocusDesc: "Prioritizes Revenue, Utilities, and Interest Rate analysis automatically",
        detailedExplanations: "Detailed Explanations",
        detailedExplanationsDesc: "Every anomaly includes reasoning and business context",
        processBtn: "ğŸš€ Analyze with AI",
        idle: "Ready",
        response: "Analysis Progress",
        howItWorks: "How AI Analysis Works",
        step1Title: "ğŸ“Š Step 1: Data Analysis",
        step1Desc: "AI examines your financial data to understand company size, account patterns, and business context",
        step2Title: "ğŸ¯ Step 2: Smart Thresholds",
        step2Desc: "Automatically determines materiality thresholds and focuses on critical areas: Revenue, Utilities, Interest Rates",
        step3Title: "ğŸ” Step 3: Anomaly Detection",
        step3Desc: "Identifies unusual patterns, variance issues, and accounting inconsistencies with detailed explanations",
        step4Title: "ğŸ“‹ Step 4: Detailed Report",
        step4Desc: "Generates Excel report with specific findings, business reasoning, and recommended actions",
        downloadTitle: "ğŸ“¥ Download Results",
        downloadBtn: "Download Analysis"
      },
      "vi": {
        title: "CÃ´ng Cá»¥ PhÃ¢n TÃ­ch Sai Lá»‡ch AI",
        subtitle: "Táº£i Excel â†’ AI PhÃ¢n TÃ­ch â†’ Táº£i Káº¿t Quáº£",
        uploadRun: "Táº£i LÃªn & Xá»­ LÃ½",
        excelLabel: "Tá»‡p Excel",
        excelHelp: "Chá»n má»™t hoáº·c nhiá»u tá»‡p .xlsx Ä‘á»ƒ AI phÃ¢n tÃ­ch",
        aiInfoTitle: "ğŸ¤– PhÃ¢n TÃ­ch Báº±ng AI",
        autoMateriality: "Tá»± Äá»™ng PhÃ¡t Hiá»‡n Má»©c Trá»ng Yáº¿u",
        autoMaterialityDesc: "AI xÃ¡c Ä‘á»‹nh ngÆ°á»¡ng quan trá»ng dá»±a trÃªn quy mÃ´ cÃ´ng ty vÃ  máº«u dá»¯ liá»‡u",
        smartFocus: "LÄ©nh Vá»±c Táº­p Trung ThÃ´ng Minh",
        smartFocusDesc: "Æ¯u tiÃªn phÃ¢n tÃ­ch Doanh thu, Tiá»‡n Ã­ch vÃ  LÃ£i suáº¥t tá»± Ä‘á»™ng",
        detailedExplanations: "Giáº£i ThÃ­ch Chi Tiáº¿t",
        detailedExplanationsDesc: "Má»—i báº¥t thÆ°á»ng bao gá»“m lÃ½ do vÃ  bá»‘i cáº£nh kinh doanh",
        processBtn: "ğŸš€ PhÃ¢n TÃ­ch vá»›i AI",
        idle: "Sáºµn SÃ ng",
        response: "Tiáº¿n TrÃ¬nh PhÃ¢n TÃ­ch",
        howItWorks: "CÃ¡ch AI PhÃ¢n TÃ­ch Hoáº¡t Äá»™ng",
        step1Title: "ğŸ“Š BÆ°á»›c 1: PhÃ¢n TÃ­ch Dá»¯ Liá»‡u",
        step1Desc: "AI kiá»ƒm tra dá»¯ liá»‡u tÃ i chÃ­nh Ä‘á»ƒ hiá»ƒu quy mÃ´ cÃ´ng ty, máº«u tÃ i khoáº£n vÃ  bá»‘i cáº£nh kinh doanh",
        step2Title: "ğŸ¯ BÆ°á»›c 2: NgÆ°á»¡ng ThÃ´ng Minh",
        step2Desc: "Tá»± Ä‘á»™ng xÃ¡c Ä‘á»‹nh ngÆ°á»¡ng trá»ng yáº¿u vÃ  táº­p trung vÃ o cÃ¡c lÄ©nh vá»±c quan trá»ng: Doanh thu, Tiá»‡n Ã­ch, LÃ£i suáº¥t",
        step3Title: "ğŸ” BÆ°á»›c 3: PhÃ¡t Hiá»‡n Báº¥t ThÆ°á»ng",
        step3Desc: "XÃ¡c Ä‘á»‹nh cÃ¡c máº«u báº¥t thÆ°á»ng, váº¥n Ä‘á» sai lá»‡ch vÃ  khÃ´ng nháº¥t quÃ¡n káº¿ toÃ¡n vá»›i giáº£i thÃ­ch chi tiáº¿t",
        step4Title: "ğŸ“‹ BÆ°á»›c 4: BÃ¡o CÃ¡o Chi Tiáº¿t",
        step4Desc: "Táº¡o bÃ¡o cÃ¡o Excel vá»›i cÃ¡c phÃ¡t hiá»‡n cá»¥ thá»ƒ, lÃ½ do kinh doanh vÃ  hÃ nh Ä‘á»™ng khuyáº¿n nghá»‹",
        downloadTitle: "ğŸ“¥ Táº£i Káº¿t Quáº£",
        downloadBtn: "Táº£i PhÃ¢n TÃ­ch"
      }
    };

    let currentLang = "en";
    function switchLanguage(lang) {
      currentLang = lang;
      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });

      document.querySelectorAll(".btn.small").forEach(btn => btn.classList.remove("active"));
      document.getElementById(`lang-${lang}`).classList.add("active");
    }

    document.getElementById("lang-en").onclick = () => switchLanguage("en");
    document.getElementById("lang-vi").onclick = () => switchLanguage("vi");

    // Initialize
    switchLanguage("en");
  </script>

  <!-- Bump cache-buster when script changes -->
  <script src="/frontend/script.js?v=1" defer></script>
</body>
</html>